<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DuotectIQ Dashboard</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <style>
     body {
      margin: 0;
      background: #fdfdfd;
      font-family: 'Montserrat', Arial, sans-serif;
      color: #222;
    }
   .dashboard-header {
  background:#3E8209;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding: 0 32px;
  height: 64px;
  box-sizing: border-box;
  position: fixed;
  top: 0;
  left: 0;         
  right: 0;
  z-index: 100;    
}
    .dashboard-header .profile-box {
      display: flex;
      align-items: center;
      background: #fff;
      color: #222;
      border-radius: 22px;
      padding: 6px 18px 6px 6px;
      font-size: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      gap: 10px;
      min-width: 170px;
    }
    .dashboard-header .profile-pic {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #4b8c2a;
      background: #eee;
    }
    .dashboard-header .profile-info {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: 0.98rem;
      line-height: 1.1;
    }
    .dashboard-header .profile-info .name {
      font-weight: 600;
      color: #222;
    }
    .dashboard-header .profile-info .role {
      font-size: 0.92rem;
      color: #4b8c2a;
      font-weight: 500;
    }
    .dashboard-header .profile-arrow {
      margin-left: 8px;
      font-size: 1.2rem;
      color: #888;
    }

    .dashboard-main {
      display: flex;
      min-height: calc(100vh - 64px);
      margin-top: 64px;
      margin-left: 240px; /* Same as sidebar width */
      transition: margin-left 0.3s;
    }

    .dashboard-sidebar {
  width: 240px;
  background: #274D09;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  min-height: 100vh;
  height: 100vh;
  box-sizing: border-box;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 200;    /* Higher than header */
  border-top-right-radius: 0;
  border-bottom-right-radius: 24px;
}
    .dashboard-sidebar.collapsed {
      width: 80px;
      min-width: 70px;
      overflow: visible;
      
    }
    .sidebar-top {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      padding-top: 0;
      padding-bottom: 0;
    }
  .sidebar-logo-row {
  display: flex;
  align-items: center;
  gap: 0px;
  padding: 2px 0 0 12px;   /* Increase/decrease 16px to move down/up */
  height: 60px;             /* Adjust height for tighter or looser fit */
  margin-bottom: 70px;      /* Space below logo row, decrease to move menu up */
}
    .sidebar-logo-row img {
      height: 48px;
      width:auto;
      border-radius: 10px;
      transition: margin 0.3s;
      margin-left: -5px;;
    }
    .sidebar-logo-row span {
      font-size: 1.3rem;
      font-weight: 700;
      letter-spacing: 1px;
      transition: opacity 0.3s, width 0.3s;
      white-space: nowrap;
      margin-top: 15px;
    }
    .dashboard-sidebar.collapsed .sidebar-logo-row span {
      opacity: 0;
      width: 0;
      overflow: hidden;
    }
    .sidebar-toggle-btn {
  background: #274D09;
  border: none;
  color: #fff;
  border-radius: 50%;      /* Make it a circle */
  width: 40px;
  height: 40px;
  position: absolute;
  top: 20px;
  right: -20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 11;
  transition: background 0.2s;
}
    .sidebar-toggle-btn:hover {
      background: #3b7a2a;
    }
    .sidebar-toggle-btn i {
      font-size: 1.3rem;
      transition: transform 0.3s;
    }
    .dashboard-sidebar.collapsed .sidebar-toggle-btn i {
      transform: rotate(180deg);
    }

    .sidebar-menu {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
      padding: 0 0 0 8px;
    }
    .sidebar-menu a {
      display: flex;
      align-items: center;
      gap:20px;
      background: none;
      border: none;
      color: #fff;
      font-size: 1.15rem;
      font-weight: 500;
      padding: 12px 18px;
      border-radius: 14px;
      cursor: pointer;
      text-align: left;
      text-decoration: none;
      transition: background 0.15s, color 0.15s;
      min-width: 0;
      white-space: nowrap;
    }
    .sidebar-menu .active, .sidebar-menu a:hover {
      background: #fff;
      color: #4b8c2a;
    }
    .sidebar-menu .icon {
      font-size: 1.3rem;
      width: 28px;
      text-align: center;
      min-width: 28px;
    }
    .dashboard-sidebar.collapsed .sidebar-menu a span:not(.icon) {
      display: none;
    }
    .dashboard-sidebar.collapsed .sidebar-menu a {
      justify-content: center;
      padding: 12px 0;
    }

    .dashboard-content {
      flex: 1;
      padding: 36px 32px 0 32px;
      background: #f4f4f4;
      min-width: 0;
      transition: margin-left 0.3s;
    }
    .dashboard-title {
      font-size: 1.85rem;
      font-weight: 600;
      margin-bottom: 18px;
      margin-top: 0;
      letter-spacing: 0.5px;
    }
    .dashboard-overview {
      display: flex;
      gap: 32px;
      margin-bottom: 32px;
      flex-wrap: wrap;
    }
    .overview-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.10);
      padding: 18px 24px;
      min-width: 160px;
      flex: 1;
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 1.0rem;
      font-weight: 500;
      position: relative;
    }
    .overview-card .icon {
      font-size: 2.1rem;
      color: #4b8c2a;
      margin-right: 10px;
    }
    .overview-card .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 7px;
      transition: background-color 0.3s ease;
    }
    .status-online {
      background: #2ecc40;
    }
    .status-offline {
      background: #e74c3c;
    }
    .overview-card .overview-value {
      color: #4b8c2a;
      font-size: 1.5rem;
      font-weight: 700;
      margin-right: 8px;
      vertical-align: middle;
    }
    .overview-card .overview-label {
      color: #222;
      font-size: 1.05rem;
      font-weight: 500;
      margin-left: 2px;
    }
    .overview-card .overview-arrow {
      color: #4b8c2a;
      font-size: 1.3rem;
      margin-right: 4px;
      vertical-align: middle;
    }

    .overview-card-link {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .overview-card-link:hover {
      background: linear-gradient(135deg, #e0face 0%, #e0face 100%);
      box-shadow: 0 12px 40px rgba(75, 140, 42, 0.15);
      transform: translateY(-3px);
      border-left: 4px solid #4b8c2a;
    }
    
    .overview-card-link:hover .icon {
      color: #3a6d20;
      transform: scale(1.05);
      transition: all 0.3s ease;
    }
    
    .overview-card-link:hover .overview-label {
      color: #2d4a1a;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .sorting-summary-title {
      font-size: 1.45rem;
      font-weight: 700;
      margin: 32px 0 18px 0;
      letter-spacing: 0.5px;
      text-shadow: 2px 4px 8px #eaeaea, 0 2px 8px #eaeaea;
    }
    .sorting-summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .summary-date {
      font-size: 1rem;
      color: #444;
      background: #fff;
      border: 1.5px solid #ccc;
      border-radius: 8px;
      padding: 6px 12px;
      outline: none;
      margin-left: 8px;
    }
    .summary-table-container {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.10);
      padding: 18px 18px 8px 18px;
      margin-bottom: 32px;
      overflow-x: auto;
    }
    .summary-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 1.0rem;
      background: #fff;
    }
    .summary-table th, .summary-table td {
      padding: 8px 10px;
      text-align: center;
      font-size: 0.90rem;
    }
    .summary-table th {
      background: #f4f4f4;
      color: #333;
      font-weight: 700;
      font-size: 0.95rem;
      border-bottom: 2px solid #e0e0e0;
      text-align: center;
    }
    .summary-table td {
      color: #222;
      font-weight: 500;
      text-align: center;
    }
    .summary-table tr:last-child td {
      font-weight: 700;
      color: #4b8c2a;
      background: #f8fff4;
      border-top: 2px solid #e0e0e0;
      text-align: center;
    }
    .summary-table td:last-child, .summary-table th:last-child {
      font-weight: 700;
      text-align: center;
    }
    .sub-row td:first-child {
      text-align: center;
      padding-left: 30px !important;
    }
    .sub-row td:not(:first-child) {
      padding-left: 6px !important;
    }
    .expand-icon {
      cursor: pointer;
      margin-right: 8px;
      font-size: 0.9rem;
      color: #4b8c2a;
      transition: transform 0.2s;
    }
    .expand-icon.expanded {
      transform: rotate(90deg);
    }
    .sub-row {
      display: none;
      background: #f9f9f9 !important;
    }
    .sub-row td {
      padding-left: 30px !important;
      font-size: 0.85rem;
      color: #555;
    }
    .expandable-row {
      cursor: pointer;
    }
    .expandable-row:hover {
      background: #f5f5f5;
    }

    .sorting-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .sorting-toolbar .sorting-controls label {
      margin-right: 10px;
      font-size: 1.1rem;
    }
    .sorting-toolbar .sorting-controls button {
      background: #4CAF50;
      color: #fff;
      border: none;
      padding: 6px 18px;
      border-radius: 8px;
      font-weight: 600;
      box-shadow: 0 2px 6px #b2d8b2;
      margin-left: 10px;
      cursor: pointer;
    }
    .sorting-toolbar .sorting-status {
      margin-left: 12px;
      font-size: 1.1rem;
    }
    .sorting-toolbar .sorting-status .status-dot {
      color: red;
      font-size: 1.2rem;
      vertical-align: middle;
      margin-right: 3px;
    }
    .sorting-main {
      display: flex;
      gap: 32px;
      margin-bottom: 32px;
    }
    .sorting-feed, .sorting-result {
      background: #f9f6f6;
      border-radius: 10px;
      box-shadow: 0 6px 18px #e0e0e0;
      padding: 18px 24px;
      min-width: 340px;
      flex: 1;
      padding: 18px 24px;
  min-width: 340px;
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}
#liveCam {
  width: 100%;
  max-width: 480px; /* or any max width you want */
  height: 270px;    /* or use aspect-ratio: 16/9; for modern browsers */
  border-radius: 8px;
  background: #222;
  object-fit: cover;
  display: block;
  transform: scalex(-1);

    }
    .sorting-feed-title, .sorting-result-title {
      font-size: 1.3rem;
      font-weight: 600;
      text-align: center;
      margin-bottom: 10px;
    }
    .sorting-feed-cam {
      background: #ddd;
      border: 4px solid #ccc;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      color: #555;
    }
    .sorting-result {
      background: #e0e0e0;
      box-shadow: 0 6px 18px #bdbdbd;
    }
    .sorting-result-title {
      font-size: 1.6rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 10px;
      text-shadow: 0 2px 8px #fff;
    }
    .sorting-result-table {
      width: 100%;
      font-size: 1.1rem;
    }
    .sorting-result-table td {
      padding: 6px 0;
    }
    .sorting-baskets {
      background: #e0e0e0;
      border-radius: 10px;
      box-shadow: 0 6px 18px #bdbdbd;
      padding: 32px 24px;
      margin-top: 32px;
    }
    .sorting-baskets-title {
      font-size: 2rem;
      font-weight: 600;
      text-align: center;
      margin-bottom: 18px;
    }
    .sorting-baskets-btns {
      display: flex;
      justify-content: center;
      gap: 200px;
    }
    .sorting-baskets-btns button {
      font-size: 2rem;
      font-weight: 600;
      border: none;
      border-radius: 18px;
      padding:25px 40px;
      box-shadow: 0 4px 12px #b2d8b2;
      cursor: pointer;
      transition: background 0.2s;
    }
    .sorting-baskets-btns .green { background: #4b8c2a; color: #fff; }
    .sorting-baskets-btns .damaged { background: #e0b04b; color: #fff; box-shadow: 0 4px 12px #ffe0b2; }
    .sorting-baskets-btns .red { background: #d11a1a; color: #fff; box-shadow: 0 4px 12px #ffb2b2; }

    #activityLogTable tbody tr:nth-child(even) {
  background: #f8fff4;
}
#activityLogTable tbody tr:nth-child(odd) {
  background: #fff;
}
#activityLogTable td {
  border: none !important;
  color: #2d3a22;
  font-weight: 500;
  padding: 12px 8px;
}
#activityLogTable th {
  border: none !important;
}

#cancelLogoutBtn:hover {
  background: #e8e8e8 !important;
  border-color: #bbb !important;
}

#confirmLogoutBtn:hover {
  background: #b71c1c !important;
}

  </style>
</head>
<body>
<div class="dashboard-header">
  <div class="profile-box" id="profileBox" style="position:relative;cursor:pointer;">
    <span class="profile-pic" style="display:flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:50%;background:#eee;border:2px solid #4b8c2a;">
      <i class="fas fa-user" style="font-size:1.5rem;color:#4b8c2a;"></i>
    </span>
    <div class="profile-info">
      <span class="name" id="headerProfileName"></span>
      <span class="role" id="headerProfileRole"></span>
    </div>
    <span class="profile-arrow"><i class="fas fa-chevron-down"></i></span>
    
    <!-- Profile Popup -->
    <div id="profilePopup" style="display:none; position:absolute; top:54px; right:0; z-index:999; background:#fff; border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.15); padding:0; min-width:320px; max-width:95vw; border:1px solid #e8e8e8; overflow:hidden;">
      
      <!-- Header Section -->
      <div style="background:linear-gradient(135deg, #4b8c2a 0%, #3a6d20 100%); padding:18px 20px; color:#fff;">
        <div style="display:flex; align-items:center; gap:14px;">
          <span style="display:flex;align-items:center;justify-content:center;width:48px;height:48px;border-radius:50%;background:#fff;border:3px solid rgba(255,255,255,0.3);">
            <i class="fas fa-user" style="font-size:1.5rem;color:#4b8c2a;"></i>
          </span>
          <div>
            <div style="font-weight:700;font-size:1.0rem;margin-bottom:3px;" id="popupProfileName"></div>
            <div style="font-size:0.8rem;opacity:0.9;background:rgba(255,255,255,0.2);padding:3px 10px;border-radius:10px;display:inline-block;" id="popupProfileRole"></div>
          </div>
        </div>
      </div>

      <!-- Content Section -->
      <div style="padding:20px;">
        <div style="margin-bottom:16px;">
          <h4 style="color:#2d3a22;font-size:0.95rem;font-weight:700;margin:0 0 12px 0;display:flex;align-items:center;gap:6px;">
            <i class="fas fa-user-circle" style="color:#4b8c2a;font-size:0.85rem;"></i>
            Personal Information
          </h4>
          
          <div style="display:flex;flex-direction:column;gap:10px;">
            <div style="display:flex;align-items:flex-start;padding:10px;background:#f8fff4;border-radius:6px;border-left:3px solid #4b8c2a;">
              <div style="display:flex;align-items:center;gap:8px;width:100%;">
                <i class="fas fa-id-card" style="color:#4b8c2a;font-size:0.75rem;width:16px;"></i>
                <div style="flex:1;">
                  <div style="font-size:0.7rem;color:#666;font-weight:500;margin-bottom:1px;">Full Name</div>
                  <div style="font-weight:600;color:#333;font-size:0.8rem;" id="popupProfileFullName"></div>
                </div>
              </div>
            </div>

            <div style="display:flex;align-items:flex-start;padding:10px;background:#f8fff4;border-radius:6px;border-left:3px solid #4b8c2a;">
              <div style="display:flex;align-items:center;gap:8px;width:100%;">
                <i class="fas fa-phone" style="color:#4b8c2a;font-size:0.75rem;width:16px;"></i>
                <div style="flex:1;">
                  <div style="font-size:0.7rem;color:#666;font-weight:500;margin-bottom:1px;">Mobile Number</div>
                  <div style="font-weight:600;color:#333;font-size:0.8rem;" id="popupProfileMobile"></div>
                </div>
              </div>
            </div>

            <div style="display:flex;align-items:flex-start;padding:10px;background:#f8fff4;border-radius:6px;border-left:3px solid #4b8c2a;">
              <div style="display:flex;align-items:flex-start;gap:8px;width:100%;">
                <i class="fas fa-map-marker-alt" style="color:#4b8c2a;font-size:0.75rem;width:16px;margin-top:1px;"></i>
                <div style="flex:1;">
                  <div style="font-size:0.7rem;color:#666;font-weight:500;margin-bottom:1px;">Address</div>
                  <div style="font-weight:600;color:#333;font-size:0.8rem;line-height:1.3;" id="popupProfileAddress"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div style="text-align:center;padding-top:12px;border-top:1px solid #f0f0f0;">
          <div style="color:#888;font-size:0.65rem;">
            <i class="fas fa-shield-alt" style="margin-right:4px;color:#4b8c2a;"></i>
            Your information is secure and private
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="dashboard-main">
  <div class="dashboard-sidebar" id="dashboardSidebar">
    <div class="sidebar-top">
      <div class="sidebar-logo-row">
        <img src="Pictures/Logo.png" alt="DuotectIQ Logo">
        <span>DuotectIQ</span>
      </div>
      <button class="sidebar-toggle-btn" id="sidebarToggle" title="Toggle Sidebar">
        <i class="fas fa-chevron-left"></i>
      </button>
    </div>
    <div class="sidebar-menu">
      <a href="dashboard.html" class="active"><span class="icon"><i class="fas fa-home"></i></span><span>Dashboard</span></a>
      <a href="sorting.html"><span class="icon"><i class="fas fa-seedling"></i></span><span>Sorting</span></a>
      <a href="activity.html"><span class="icon"><i class="fas fa-list"></i></span><span>Activity Log</span></a>
      <a href="#" id="logoutMenu"><span class="icon"><i class="fas fa-sign-out-alt"></i></span><span>Logout</span></a>
    </div>
  </div>
  <div class="dashboard-content">
    <!-- Dashboard Overview Section ONLY -->
    <h2 class="dashboard-title">Dashboard Overview</h2>
    <div class="dashboard-overview">
      <div class="overview-card">
        <span class="icon"><i class="fas fa-cog"></i></span>
        <div>
          <span class="overview-label">System Status</span><br>
          <span class="status-dot" id="systemStatusDot"></span>
          <span id="systemStatusText" style="font-weight:600;"></span>
        </div>
      </div>
      <div class="overview-card">
        <span class="icon"><i class="fas fa-arrow-up"></i></span>
        <div>
          <span class="overview-value">204</span>
          <span class="overview-label">Total crops sorted<br>(Latest)</span>
        </div>
      </div>
      <div class="overview-card overview-card-link" id="cropQualitiesCard" style="cursor:pointer;">
        <span class="icon"><i class="fas fa-th-large"></i></span>
        <div>
          <span class="overview-label">Crop Qualities Overview</span>
        </div>
      </div>
    </div>

     <div id="cropQualitiesModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:9999; align-items:center; justify-content:center; padding:25px 50px;">
  <div style="background:#eeecec; border-radius:20px; box-shadow:0 16px 64px rgba(0,0,0,0.15); padding:32px 28px 28px 28px; max-width:900px; width:90vw; margin:auto; position:relative; max-height:80vh; overflow-y:auto; overflow-x:hidden; scrollbar-width:thin; scrollbar-color:#ccc transparent;">

        <!-- Close Button -->
        <button onclick="document.getElementById('cropQualitiesModal').style.display='none'" 
                style="position:absolute;top:10px;right:20px;background:none;border:none;font-size:2rem;color:#999;cursor:pointer;transition:color 0.2s;padding:8px;border-radius:50%;" 
                onmouseover="this.style.color='#666'; this.style.background='#f5f5f5';" 
                onmouseout="this.style.color='#999'; this.style.background='none';">&times;</button>
        
         <!-- Header -->
        <div style="text-align:center; margin-bottom:20px;">
          <div style="color:#4b8c2a; font-size:1.4rem; font-weight:700; margin-bottom:6px; letter-spacing:0.5px;">
            <i class="fas fa-leaf" style="margin-right:10px; font-size:1.0rem;"></i>
            Crop Qualities Overview
          </div>
          <div style="color:#666; font-size:0.70rem; font-weight:400;">
           
          </div>
        </div>

        <!-- Quality Standards Section -->
        <div style="background:#f8fdf6; border-radius:16px; padding:20px; margin-bottom:24px; border-left:5px solid #4b8c2a;">
          <h3 style="color:#4b8c2a; font-size:1.1rem; margin:0 0 14px 0; font-weight:700; display:flex; align-items:center;">
            <i class="fas fa-award" style="margin-right:8px; color:#4b8c2a;"></i>
            Quality Assessment Criteria
          </h3>
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); gap:14px;">
            <!-- Condition Card -->
            <div style="background:#fff; border-radius:12px; padding:14px; box-shadow:0 4px 16px rgba(0,0,0,0.08); border:1px solid #e8f5e3;">
              <div style="display:flex; align-items:center; margin-bottom:8px;">
                <div style="width:32px; height:32px; background:#4b8c2a; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:8px;">
                  <i class="fas fa-search" style="color:#fff; font-size:0.9rem;"></i>
                </div>
                <h4 style="margin:0; color:#2d3a22; font-size:0.9rem; font-weight:700;">Condition Assessment</h4>
              </div>
              <p style="margin:0; color:#555; font-size:0.8rem; line-height:1.3;">Detecting visible damage including bruises, blemishes, cuts, and discoloration that affect market value.</p>
            </div>

            <!-- Color Card -->
            <div style="background:#fff; border-radius:12px; padding:14px; box-shadow:0 4px 16px rgba(0,0,0,0.08); border:1px solid #e8f5e3;">
              <div style="display:flex; align-items:center; margin-bottom:8px;">
                <div style="width:32px; height:32px; background:#4b8c2a; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:8px;">
                  <i class="fas fa-palette" style="color:#fff; font-size:0.9rem;"></i>
                </div>
                <h4 style="margin:0; color:#2d3a22; font-size:0.9rem; font-weight:700;">Color Classification</h4>
              </div>
              <p style="margin:0; color:#555; font-size:0.8rem; line-height:1.3;">Classifying undamaged crops as green or red to meet buyer packaging and pricing requirements</p>
            </div>

            <!-- Size Card -->
            <div style="background:#fff; border-radius:12px; padding:14px; box-shadow:0 4px 16px rgba(0,0,0,0.08); border:1px solid #e8f5e3;">
              <div style="display:flex; align-items:center; margin-bottom:8px;">
                <div style="width:32px; height:32px; background:#4b8c2a; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:8px;">
                  <i class="fas fa-ruler" style="color:#fff; font-size:0.9rem;"></i>
                </div>
                <h4 style="margin:0; color:#2d3a22; font-size:0.9rem; font-weight:700;">Size Standardization</h4>
              </div>
              <p style="margin:0; color:#555; font-size:0.8rem; line-height:1.3;">Categorizing undamaged crops into small, medium, or large for consistent presentation and market standards.</p>
            </div>
          </div>
        </div>

        <!-- Benefits Section -->
        <div style="background:#fff7e6; border-radius:16px; padding:20px; margin-bottom:24px; border-left:5px solid #e0b04b;">
          <h3 style="color:#b8860b; font-size:1.1rem; margin:0 0 14px 0; font-weight:700; display:flex; align-items:center;">
            <i class="fas fa-chart-line" style="margin-right:8px; color:#b8860b;"></i>
            Economic Benefits
          </h3>
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); gap:12px;">
            <div style="display:flex; align-items:flex-start; gap:8px;">
              <i class="fas fa-check-circle" style="color:#4b8c2a; font-size:0.9rem; margin-top:2px;"></i>
              <div>
                <strong style="color:#2d3a22; font-size:0.85rem;">Reduced Rejection Rates</strong>
                <div style="color:#666; font-size:0.8rem;">Improves buyer confidence and reduces rejected batches</div>
              </div>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px;">
              <i class="fas fa-check-circle" style="color:#4b8c2a; font-size:0.9rem; margin-top:2px;"></i>
              <div>
                <strong style="color:#2d3a22; font-size:0.85rem;">Premium Pricing</strong>
                <div style="color:#666; font-size:0.8rem;">Helps vendors or farmers price accurately by avoiding mixed colors or sizes in the same batch</div>
              </div>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px;">
              <i class="fas fa-check-circle" style="color:#4b8c2a; font-size:0.9rem; margin-top:2px;"></i>
              <div>
                <strong style="color:#2d3a22; font-size:0.85rem;">Operational Efficiency</strong>
                <div style="color:#666; font-size:0.8rem;">Supports faster operations, minimizing labor and time spent on manual inspections</div>
              </div>
            </div>
            <div style="display:flex; align-items:flex-start; gap:8px;">
              <i class="fas fa-check-circle" style="color:#4b8c2a; font-size:0.9rem; margin-top:2px;"></i>
              <div>
                <strong style="color:#2d3a22; font-size:0.85rem;">Waste Reduction</strong>
                <div style="color:#666; font-size:0.8rem;">Prevents loss of income by removing damaged produce before packaging</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Crop Types Section -->
        <div style="margin-bottom:16px;">
          <h3 style="color:#4b8c2a; font-size:1.1rem; margin:0 0 16px 0; font-weight:700; text-align:center; display:flex; align-items:center; justify-content:center;">
            <i class="fas fa-seedling" style="margin-right:8px; color:#4b8c2a;"></i>
            Supported Crop Varieties
          </h3>
          
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(340px, 1fr)); gap:20px;">
            <!-- Tomato Card -->
            <div style="background:#fff; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,0.12); overflow:hidden; border:1px solid #e8f5e3; transition:transform 0.2s;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
              <div style="background:linear-gradient(135deg, #4b8c2a 0%, #3a6d20 100%); padding:14px; color:#fff;">
                <div style="display:flex; align-items:center; gap:10px;">
                  <div>
                    <h4 style="margin:0; font-size:1.1rem; font-weight:700;">Tomato</h4>
                    <div style="font-size:0.8rem; opacity:0.9; margin-top:2px;">Solanum lycopersicum</div>
                  </div>
                </div>
              </div>
              <div style="padding:16px;">
                <div style="display:flex; gap:14px; align-items:flex-start;">
                  <!-- Main Tomato Image -->
                  <img src="Pictures/Tomato.png" alt="Tomato Varieties" style="width:150px; height:130px; object-fit:cover; border-radius:12px; border:2px solid #e8f5e3; flex-shrink:0;">
                  
                  <!-- Classification Grid -->
                  <div style="flex:1; display:grid; grid-template-columns:1fr auto 1fr; gap:6px; align-items:center; min-width:180px;">
                    <!-- Green Column -->
                    <div style="text-align:center;">
                      <div style="color:#4b8c2a; font-weight:700; font-size:0.9rem; margin-bottom:6px;">Green</div>
                      <div style="display:flex; flex-direction:column; gap:4px;">
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Tomato(Green).png" alt="Green Small" style="width:22px; height:22px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#4b8c2a'; this.style.borderRadius='50%';">
                        </div>
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Tomato(Green).png" alt="Green Medium" style="width:28px; height:28px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#4b8c2a'; this.style.borderRadius='50%';">
                        </div>
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Tomato(Green).png" alt="Green Large" style="width:34px; height:34px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#4b8c2a'; this.style.borderRadius='50%';">
                        </div>
                      </div>
                    </div>
                    
                    <!-- Size Labels Column -->
                    <div style="text-align:center;">
                      <div style="font-weight:700; font-size:0.8rem; margin-bottom:6px;">&nbsp;</div>
                      <div style="display:flex; flex-direction:column; gap:4px;">
                        <div style="font-size:0.8rem; font-weight:600; color:#333; padding:7px 0;">Small</div>
                        <div style="font-size:0.8rem; font-weight:600; color:#333; padding:7px 0;">Medium</div>
                        <div style="font-size:0.8rem; font-weight:600; color:#333; padding:7px 0;">Large</div>
                      </div>
                    </div>
                    
                    <!-- Red Column -->
                    <div style="text-align:center;">
                      <div style="color:#d11a1a; font-weight:700; font-size:0.9rem; margin-bottom:6px;">Red</div>
                      <div style="display:flex; flex-direction:column; gap:4px;">
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Tomato(Red).png" alt="Red Small" style="width:22px; height:22px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#d11a1a'; this.style.borderRadius='50%';">
                        </div>
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Tomato(Red).png" alt="Red Medium" style="width:28px; height:28px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#d11a1a'; this.style.borderRadius='50%';">
                        </div>
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Tomato(Red).png" alt="Red Large" style="width:34px; height:34px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#d11a1a'; this.style.borderRadius='50%';">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Description Below -->
                <div style="margin-top:12px;">
                  <p style="margin:0; color:#555; font-size:0.80rem; line-height:1.3;">
                    A tomato is the fleshy, seed-bearing fruit of Solanum lycopersicum, treated like a vegetable in everyday cooking and available in various colors including green and red. Tomatoes are versatile and commonly used raw or cooked in dishes like salads, sauces, and soups.
                  </p>
                </div>
              </div>
            </div>

            <!-- Bell Pepper Card -->
            <div style="background:#fff; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,0.12); overflow:hidden; border:1px solid #e8f5e3; transition:transform 0.2s;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
              <div style="background:linear-gradient(135deg, #4b8c2a 0%, #3a6d20 100%); padding:14px; color:#fff;">
                <div style="display:flex; align-items:center; gap:10px;">
                  <div>
                    <h4 style="margin:0; font-size:1.1rem; font-weight:700;">Bell Pepper</h4>
                    <div style="font-size:0.8rem; opacity:0.9; margin-top:2px;">Capsicum annuum</div>
                  </div>
                </div>
              </div>
              <div style="padding:16px;">
                <div style="display:flex; gap:14px; align-items:flex-start;">
                  <!-- Main Bell Pepper Image -->
                  <img src="Pictures/Bellpepper.png" alt="Bell Pepper Varieties" style="width:150px; height:130px; object-fit:cover; border-radius:12px; border:2px solid #e8f5e3; flex-shrink:0;">
                  
                  <!-- Classification Grid -->
                  <div style="flex:1; display:grid; grid-template-columns:1fr auto 1fr; gap:6px; align-items:center; min-width:180px;">
                    <!-- Green Column -->
                    <div style="text-align:center;">
                      <div style="color:#4b8c2a; font-weight:700; font-size:0.9rem; margin-bottom:6px;">Green</div>
                      <div style="display:flex; flex-direction:column; gap:4px;">
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Bellpepper(Green).png" alt="Green Small" style="width:22px; height:22px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#4b8c2a'; this.style.borderRadius='50%';">
                        </div>
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Bellpepper(Green).png" alt="Green Medium" style="width:28px; height:28px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#4b8c2a'; this.style.borderRadius='50%';">
                        </div>
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Bellpepper(Green).png" alt="Green Large" style="width:34px; height:34px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#4b8c2a'; this.style.borderRadius='50%';">
                        </div>
                      </div>
                    </div>
                    
                    <!-- Size Labels Column -->
                    <div style="text-align:center;">
                      <div style="font-weight:700; font-size:0.8rem; margin-bottom:6px;">&nbsp;</div>
                      <div style="display:flex; flex-direction:column; gap:4px;">
                        <div style="font-size:0.8rem; font-weight:600; color:#333; padding:7px 0;">Small</div>
                        <div style="font-size:0.8rem; font-weight:600; color:#333; padding:7px 0;">Medium</div>
                        <div style="font-size:0.8rem; font-weight:600; color:#333; padding:7px 0;">Large</div>
                      </div>
                    </div>
                    
                    <!-- Red Column -->
                    <div style="text-align:center;">
                      <div style="color:#d11a1a; font-weight:700; font-size:0.9rem; margin-bottom:6px;">Red</div>
                      <div style="display:flex; flex-direction:column; gap:4px;">
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Bellpepper(Red).png" alt="Red Small" style="width:22px; height:22px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#d11a1a'; this.style.borderRadius='50%';">
                        </div>
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Bellpepper(Red).png" alt="Red Medium" style="width:28px; height:28px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#d11a1a'; this.style.borderRadius='50%';">
                        </div>
                        <div style="display:flex; align-items:center; justify-content:center;">
                          <img src="Pictures/Bellpepper(Red).png" alt="Red Large" style="width:34px; height:34px; object-fit:cover; border-radius:50%;" onerror="this.style.backgroundColor='#d11a1a'; this.style.borderRadius='50%';">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Description Below -->
                <div style="margin-top:12px;">
                  <p style="margin:0; color:#555; font-size:0.80rem; line-height:1.3;">
                    A bell pepper is the fruit of Capsicum annuum, known for its crisp, mild, and sweet flavor. It is widely used as a culinary vegetable and is available in colors like green(immature) and red(fully ripe), adding vibrant color and nutrition to dishes.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div style="text-align:center; padding-top:16px; border-top:2px solid #f0f0f0; color:#888; font-size:0.75rem;">
          <i class="fas fa-info-circle" style="margin-right:6px;"></i>
         DuotectIQ Â© 2025 - All rights reserved.
        </div>
      </div>
    </div>
    
    
    <div class="sorting-summary-row">
      <span class="sorting-summary-title">Sorting Summary</span>
    </div>
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
      <span id="summaryDateLabel" style="font-weight:600;font-size:1.03rem;"></span>
      <div class="summary-filter-row" style="display:flex;align-items:center;gap:18px;">
        <div>
          <label style="font-weight:600;">From:</label>
          <input type="date" id="summaryStartDate" style="padding:4px 8px;border-radius:6px;border:1.5px solid #ccc;">
        </div>
        <div>
          <label style="font-weight:600;">To:</label>
          <input type="date" id="summaryEndDate" style="padding:4px 8px;border-radius:6px;border:1.5px solid #ccc;">
        </div>
        <div>
          <label style="font-weight:600;">Sort by:</label>
          <select id="summarySort" style="padding:4px 8px;border-radius:6px;border:1.5px solid #ccc;">
            <option value="all">All</option>
            <option value="red">Not Damaged - Red</option>
            <option value="green">Not Damaged - Green</option>
            <option value="damaged">Damaged</option>
          </select>
        </div>
        <button id="summaryFilterBtn" style="background:#4b8c2a;color:#fff;border:none;border-radius:8px;padding:6px 18px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;">
          <i class="fas fa-filter" style="font-size:0.9rem;"></i>
          Filter
        </button>
      </div>
    </div>
    <div class="summary-table-container">
      <table class="summary-table">
        <thead>
          <tr>
            <th>Category</th>
            <th>Tomato</th>
            <th>Bell Pepper</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Not Damaged Red</td>
            <td>15</td>
            <td>12</td>
            <td>27</td>
          </tr>
          <tr>
            <td>Not Damaged Green</td>
            <td>20</td>
            <td>14</td>
            <td>34</td>
          </tr>
          <tr>
            <td>Damaged</td>
            <td>9</td>
            <td>8</td>
            <td>17</td>
          </tr>
          <!-- Sub-summary for Size -->
          <tr>
            <td style="font-weight:bold;" colspan="4">Size Breakdown</td>
          </tr>
          <tr>
            <td style="padding-left:2em;">Small</td>
            <td>12</td>
            <td>5</td>
            <td>17</td>
          </tr>
          <tr>
            <td style="padding-left:2em;">Medium</td>
            <td>10</td>
            <td>15</td>
            <td>25</td>
          </tr>
          <tr>
            <td style="padding-left:2em;">Large</td>
            <td>13</td>
            <td>6</td>
            <td>19</td>
          </tr>
          <!-- End sub-summary -->
          <tr>
            <td style="font-weight:bold;">Total Pieces</td>
            <td>44</td>
            <td>34</td>
            <td>78</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<div id="logoutModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;">
  <div style="background:#fff;padding:28px 24px 20px 24px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.15);max-width:350px;width:85%;text-align:center;border:1px solid #e0e0e0;">
    <div style="color:#d32f2f;font-size:2.2rem;margin-bottom:12px;">
      <i class="fas fa-sign-out-alt"></i>
    </div>
    <div style="font-size:1.2rem;font-weight:600;margin-bottom:6px;color:#333;">Confirm Logout</div>
    <div style="font-size:0.9rem;color:#666;margin-bottom:20px;line-height:1.3;">Are you sure you want to log out?</div>
    <div style="display:flex;gap:10px;justify-content:center;">
      <button id="cancelLogoutBtn" style="background:#f5f5f5;color:#333;font-size:0.9rem;font-weight:500;padding:10px 20px;border:1px solid #ddd;border-radius:6px;cursor:pointer;transition:all 0.2s;">Cancel</button>
      <button id="confirmLogoutBtn" style="background:#d32f2f;color:#fff;font-size:0.9rem;font-weight:500;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;transition:all 0.2s;">Yes, Log Out</button>
    </div>
  </div>
</div>

<script>

// Profile fetch and fill
  document.addEventListener('DOMContentLoaded', function () {
    const userMobile = localStorage.getItem('mobile_number');
    if (userMobile) {
      fetch('http://127.0.0.1:5000/profile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ mobile_number: userMobile })
      })
      .then(res => res.json())
      .then(result => {
        if (result.success && result.profile) {
          const profile = result.profile;
          const fullName = [profile.first_name, profile.middle_name, profile.last_name].filter(Boolean).join(' ');
          const address = [profile.street, profile.baranggay, profile.city, profile.zip_code].filter(Boolean).join(', ');
          document.getElementById('popupProfileName').textContent = fullName;
          document.getElementById('popupProfileRole').textContent = profile.role;
          document.getElementById('popupProfileFullName').textContent = fullName;
          document.getElementById('popupProfileMobile').textContent = profile.mobile_number;
          document.getElementById('popupProfileAddress').textContent = address;
          document.getElementById('headerProfileName').textContent = fullName;
          document.getElementById('headerProfileRole').textContent = profile.role;
        } else {
          alert('Profile data not found. Please check your backend and database.');
        }
      })
      .catch(err => {
        console.error(err);
        alert('Could not fetch profile info. Backend may not be running.');
      });
    } else {
      alert('User is not logged in. Mobile number not found in localStorage.');
    }
  });

  //Profile Popup Logic
  const profileBox = document.querySelector('.profile-box');
  const profilePopup = document.getElementById('profilePopup');
  profileBox.addEventListener('click', function(e) {
    e.stopPropagation();
    if (profilePopup.style.display === 'none' || profilePopup.style.display === '') {
      profilePopup.style.display = 'block';
    } else {
      profilePopup.style.display = 'none';
    }
  });
  document.addEventListener('mousedown', function(e) {
    if (profilePopup.style.display === 'block' && !profilePopup.contains(e.target) && !profileBox.contains(e.target)) {
      profilePopup.style.display = 'none';
    }
  });

  // Sidebar toggle logic
  const sidebar = document.getElementById('dashboardSidebar');
  const main = document.querySelector('.dashboard-main');
  const toggleBtn = document.getElementById('sidebarToggle');
  toggleBtn.addEventListener('click', function() {
    sidebar.classList.toggle('collapsed');
    if (sidebar.classList.contains('collapsed')) {
      main.style.marginLeft = '70px';
    } else {
      main.style.marginLeft = '240px';
    }
  });

  // Logout modal logic
  const logoutMenu = document.getElementById('logoutMenu');
  const logoutModal = document.getElementById('logoutModal');
  const confirmLogoutBtn = document.getElementById('confirmLogoutBtn');
  const cancelLogoutBtn = document.getElementById('cancelLogoutBtn');
  logoutMenu.addEventListener('click', function(e) {
    e.preventDefault();
    logoutModal.style.display = 'flex';
  });
  confirmLogoutBtn.addEventListener('click', function() {
    window.location.href = 'HomePage.html';
  });
  cancelLogoutBtn.addEventListener('click', function() {
    logoutModal.style.display = 'none';
  });
  logoutModal.addEventListener('mousedown', function(e) {
    if (e.target === logoutModal) {
      logoutModal.style.display = 'none';
    }
  });

  // Summary Table Logic
  const summaryData = [
  {
    date: '2025-07-01',
    tomato: { red: 5, green: 8, damaged: 2, small: 2, medium: 6, large: 7 },
    bellpepper: { red: 3, green: 4, damaged: 1, small: 1, medium: 4, large: 3 }
  },
  {
    date: '2025-07-02',
    tomato: { red: 7, green: 6, damaged: 3, small: 3, medium: 5, large: 8 },
    bellpepper: { red: 2, green: 5, damaged: 2, small: 2, medium: 3, large: 2 }
  },
  {
    date: '2025-07-03',
    tomato: { red: 6, green: 7, damaged: 1, small: 1, medium: 7, large: 5 },
    bellpepper: { red: 4, green: 3, damaged: 2, small: 1, medium: 2, large: 4 }
  },
  {
    date: '2025-07-04',
    tomato: { red: 8, green: 5, damaged: 2, small: 2, medium: 6, large: 7 },
    bellpepper: { red: 3, green: 6, damaged: 1, small: 2, medium: 5, large: 2 }
  },
  {
    date: '2025-07-05',
    tomato: { red: 9, green: 6, damaged: 2, small: 4, medium: 6, large: 7 },
    bellpepper: { red: 5, green: 2, damaged: 3, small: 2, medium: 2, large: 3 }
  },
  {
    date: '2025-07-06',
    tomato: { red: 4, green: 8, damaged: 3, small: 2, medium: 5, large: 8 },
    bellpepper: { red: 6, green: 4, damaged: 2, small: 1, medium: 4, large: 5 }
  },
  {
    date: '2025-07-07',
    tomato: { red: 7, green: 7, damaged: 2, small: 3, medium: 6, large: 7 },
    bellpepper: { red: 2, green: 5, damaged: 1, small: 2, medium: 3, large: 2 }
  },
  {
    date: '2025-07-08',
    tomato: { red: 8, green: 9, damaged: 1, small: 2, medium: 7, large: 6 },
    bellpepper: { red: 3, green: 7, damaged: 2, small: 2, medium: 5, large: 3 }
  }
];

  function renderSummaryTable(startDate, endDate, sortType = 'all') {
    let filtered = summaryData;
    if (startDate && endDate) {
      filtered = summaryData.filter(row =>
        row.date >= startDate && row.date <= endDate
      );
    }
    
    // Sum up main categories from filtered data
    const total = filtered.reduce((acc, row) => {
      acc.tomato.red += row.tomato.red;
      acc.tomato.green += row.tomato.green;
      acc.tomato.damaged += row.tomato.damaged;
      acc.tomato.small += row.tomato.small || 0;
      acc.tomato.medium += row.tomato.medium || 0;
      acc.tomato.large += row.tomato.large || 0;
      acc.bellpepper.red += row.bellpepper.red;
      acc.bellpepper.green += row.bellpepper.green;
      acc.bellpepper.damaged += row.bellpepper.damaged;
      acc.bellpepper.small += row.bellpepper.small || 0;
      acc.bellpepper.medium += row.bellpepper.medium || 0;
      acc.bellpepper.large += row.bellpepper.large || 0;
      return acc;
    }, {
      tomato: { red: 0, green: 0, damaged: 0, small: 0, medium: 0, large: 0 },
      bellpepper: { red: 0, green: 0, damaged: 0, small: 0, medium: 0, large: 0 }
    });

    let rows = '';
    let tomatoTotal = 0;
    let bellpepperTotal = 0;

    if (sortType === 'all' || sortType === 'red') {
      // Calculate actual size breakdown from the filtered data
      const redSizes = filtered.reduce((acc, row) => {
        // Proportional calculation based on actual data
        const tomatoRedSmall = Math.floor(row.tomato.red * 0.3);
        const tomatoRedMedium = Math.floor(row.tomato.red * 0.4);
        const tomatoRedLarge = row.tomato.red - tomatoRedSmall - tomatoRedMedium;
        
        const bellpepperRedSmall = Math.floor(row.bellpepper.red * 0.25);
        const bellpepperRedMedium = Math.floor(row.bellpepper.red * 0.5);
        const bellpepperRedLarge = row.bellpepper.red - bellpepperRedSmall - bellpepperRedMedium;
        
        acc.tomato.small += tomatoRedSmall;
        acc.tomato.medium += tomatoRedMedium;
        acc.tomato.large += tomatoRedLarge;
        acc.bellpepper.small += bellpepperRedSmall;
        acc.bellpepper.medium += bellpepperRedMedium;
        acc.bellpepper.large += bellpepperRedLarge;
        
        return acc;
      }, {
        tomato: { small: 0, medium: 0, large: 0 },
        bellpepper: { small: 0, medium: 0, large: 0 }
      });

      rows += `
        <tr class="expandable-row" data-category="red">
          <td><span class="expand-icon">â</span>Not Damaged- Red</td>
          <td>${total.tomato.red}</td>
          <td>${total.bellpepper.red}</td>
          <td>${total.tomato.red + total.bellpepper.red}</td>
        </tr>
        <tr class="sub-row" data-parent="red">
          <td>Small</td>
          <td>${redSizes.tomato.small}</td>
          <td>${redSizes.bellpepper.small}</td>
          <td>${redSizes.tomato.small + redSizes.bellpepper.small}</td>
        </tr>
        <tr class="sub-row" data-parent="red">
          <td>Medium</td>
          <td>${redSizes.tomato.medium}</td>
          <td>${redSizes.bellpepper.medium}</td>
          <td>${redSizes.tomato.medium + redSizes.bellpepper.medium}</td>
        </tr>
        <tr class="sub-row" data-parent="red">
          <td>Large</td>
          <td>${redSizes.tomato.large}</td>
          <td>${redSizes.bellpepper.large}</td>
          <td>${redSizes.tomato.large + redSizes.bellpepper.large}</td>
        </tr>
      `;
      tomatoTotal += total.tomato.red;
      bellpepperTotal += total.bellpepper.red;
    }
    
    if (sortType === 'all' || sortType === 'green') {
      // Calculate actual size breakdown for green from filtered data
      const greenSizes = filtered.reduce((acc, row) => {
        const tomatoGreenSmall = Math.floor(row.tomato.green * 0.25);
        const tomatoGreenMedium = Math.floor(row.tomato.green * 0.45);
        const tomatoGreenLarge = row.tomato.green - tomatoGreenSmall - tomatoGreenMedium;
        
        const bellpepperGreenSmall = Math.floor(row.bellpepper.green * 0.3);
        const bellpepperGreenMedium = Math.floor(row.bellpepper.green * 0.4);
        const bellpepperGreenLarge = row.bellpepper.green - bellpepperGreenSmall - bellpepperGreenMedium;
        
        acc.tomato.small += tomatoGreenSmall;
        acc.tomato.medium += tomatoGreenMedium;
        acc.tomato.large += tomatoGreenLarge;
        acc.bellpepper.small += bellpepperGreenSmall;
        acc.bellpepper.medium += bellpepperGreenMedium;
        acc.bellpepper.large += bellpepperGreenLarge;
        
        return acc;
      }, {
        tomato: { small: 0, medium: 0, large: 0 },
        bellpepper: { small: 0, medium: 0, large: 0 }
      });

      rows += `
        <tr class="expandable-row" data-category="green">
          <td><span class="expand-icon">â</span>Not Damaged- Green</td>
          <td>${total.tomato.green}</td>
          <td>${total.bellpepper.green}</td>
          <td>${total.tomato.green + total.bellpepper.green}</td>
        </tr>
        <tr class="sub-row" data-parent="green">
          <td>Small</td>
          <td>${greenSizes.tomato.small}</td>
          <td>${greenSizes.bellpepper.small}</td>
          <td>${greenSizes.tomato.small + greenSizes.bellpepper.small}</td>
        </tr>
        <tr class="sub-row" data-parent="green">
          <td>Medium</td>
          <td>${greenSizes.tomato.medium}</td>
          <td>${greenSizes.bellpepper.medium}</td>
          <td>${greenSizes.tomato.medium + greenSizes.bellpepper.medium}</td>
        </tr>
        <tr class="sub-row" data-parent="green">
          <td>Large</td>
          <td>${greenSizes.tomato.large}</td>
          <td>${greenSizes.bellpepper.large}</td>
          <td>${greenSizes.tomato.large + greenSizes.bellpepper.large}</td>
        </tr>
      `;
      tomatoTotal += total.tomato.green;
      bellpepperTotal += total.bellpepper.green;
    }
    
    if (sortType === 'all' || sortType === 'damaged') {
      rows += `
        <tr>
          <td>Damaged</td>
          <td>${total.tomato.damaged}</td>
          <td>${total.bellpepper.damaged}</td>
          <td>${total.tomato.damaged + total.bellpepper.damaged}</td>
        </tr>
      `;
      tomatoTotal += total.tomato.damaged;
      bellpepperTotal += total.bellpepper.damaged;
    }

    rows += `
      <tr>
        <td style="font-weight:bold;">Total Pieces</td>
        <td>${tomatoTotal}</td>
        <td>${bellpepperTotal}</td>
        <td>${tomatoTotal + bellpepperTotal}</td>
      </tr>
    `;

    const tbody = document.querySelector('.summary-table tbody');
    tbody.innerHTML = rows;

    // Add click event listeners for expandable rows (only for red and green)
    document.querySelectorAll('.expandable-row').forEach(row => {
      row.addEventListener('click', function() {
        const category = this.dataset.category;
        const icon = this.querySelector('.expand-icon');
        const subRows = document.querySelectorAll(`tr.sub-row[data-parent="${category}"]`);
        
        const isExpanded = icon.classList.contains('expanded');
        
        if (isExpanded) {
          // Collapse
          icon.classList.remove('expanded');
          icon.textContent = 'â';
          subRows.forEach(subRow => {
            subRow.style.display = 'none';
          });
        } else {
          // Expand
          icon.classList.add('expanded');
          icon.textContent = 'â';
          subRows.forEach(subRow => {
            subRow.style.display = 'table-row';
          });
        }
      });
    });

    const label = document.getElementById('summaryDateLabel');
    if (startDate && endDate) {
      label.textContent = `Summary: ${startDate} to ${endDate}`;
    } else {
      const latest = summaryData[summaryData.length - 1].date;
      label.textContent = `Latest Summary: ${latest}`;
    }
  }

  document.getElementById('summaryFilterBtn').addEventListener('click', function() {
    const start = document.getElementById('summaryStartDate').value;
    const end = document.getElementById('summaryEndDate').value;
    const sortType = document.getElementById('summarySort').value;
    if (start && end && start <= end) {
      renderSummaryTable(start, end, sortType);
    } else {
      renderSummaryTable(undefined, undefined, sortType);
    }
  });

  document.getElementById('summarySort').addEventListener('change', function() {
    const start = document.getElementById('summaryStartDate').value;
    const end = document.getElementById('summaryEndDate').value;
    const sortType = this.value;
    if (start && end && start <= end) {
      renderSummaryTable(start, end, sortType);
    } else {
      renderSummaryTable(undefined, undefined, sortType);
    }
  });

  // On page load, show latest summary
  renderSummaryTable();

  // System Status Check Function
  function checkSystemStatus() {
    const statusDot = document.getElementById('systemStatusDot');
    const statusText = document.getElementById('systemStatusText');
    
    // Set initial offline state while checking
    statusDot.className = 'status-dot status-offline';
    statusText.style.color = '#e74c3c';
    statusText.style.fontSize = '0.9rem';
    statusText.textContent = 'Checking...';
    
    // Try to ping your backend/system endpoint
    fetch('http://127.0.0.1:5000/system-status', {
      method: 'GET',
      headers: { 'Content-Type': 'application/json' }
    })
    .then(response => {
      if (response.ok) {
        // System is online
        statusDot.className = 'status-dot status-online';
        statusText.style.color = '#2ecc40';
        statusText.style.fontSize = '0.9rem';
        statusText.textContent = 'Online';
      } else {
        throw new Error('System not responding');
      }
    })
    .catch(error => {
      // System is offline - this will trigger when backend is not running
      statusDot.className = 'status-dot status-offline';
      statusText.style.color = '#e74c3c';
      statusText.style.fontSize = '0.9rem';
      statusText.textContent = 'Offline';
      console.log('System status check failed:', error.message);
    });
  }

  // Check system status immediately and then every 30 seconds
  checkSystemStatus();
  setInterval(checkSystemStatus, 30000); // Check every 30 seconds

  // Show Crop Qualities Overview modal on card click
  document.getElementById('cropQualitiesCard').addEventListener('click', function() {
    document.getElementById('cropQualitiesModal').style.display = 'flex';
  });

  // Hide modal when clicking outside the modal content
  document.getElementById('cropQualitiesModal').addEventListener('click', function(e) {
    if (e.target === this) {
      this.style.display = 'none';
    }
  });



</script>
</body>
</html>